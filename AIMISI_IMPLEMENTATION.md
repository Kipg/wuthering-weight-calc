# 爱弥斯角色与新伤害类型实现说明

## 概览

本次更新添加了以下内容：
1. 两种新的伤害类型：**效应伤害**和**震谐伤害**
2. 爱弥斯角色的完整数据和技能
3. 千咲角色的骨架文件
4. 爱弥斯专用的特殊伤害计算辅助函数

## 一、新增伤害类型

### 1. 效应伤害
- **基础伤害值（90级）**: 3674
- **计算公式**: 效应伤害基础值 × 倍率加成
- **颜色标识**: #10b981（绿色）

### 2. 震谐伤害
- **偏斜基础值（COST4）**: 10027
- **计算公式**: 偏斜基础值 × 倍率加成
- **颜色标识**: #06b6d4（青色）

## 二、爱弥斯角色

### 基础信息
- **稀有度**: 5星
- **武器类型**: 迅刀
- **元素类型**: 热熔伤害
- **成长模板**: 攻击

### 技能系统

爱弥斯拥有两个共鸣模态，影响不同的固有技能和伤害计算：

#### 常态攻击
包括普通攻击4段、闪避反击、重击、空中攻击等

#### 共鸣技能
包括合击技能、机兵形态技能等

#### 共鸣回路
- **光翼共奏·登台伤害**
- **光翼共奏·降临伤害**
- **震谐响应·星爆伤害**（震谐伤害类型，不在技能选择中显示）
- **光翼共奏追加伤害（每次）**（震谐伤害类型，不在技能选择中显示）

#### 共鸣解放
- **星辉破界而来·过载**
- **星辉破界而来·终结**

### 固有技能

#### 1. 于万籁之前
- **效果**: 处于即刻响应状态时，重击·爱弥斯、重击·机兵造成的伤害加深200%
- **作用范围**: 特定技能名称（重击相关）

#### 2. 星与星之间·震谐（共鸣模态：震谐）
- **暴击伤害提升**: 20% × 层数（最多3层）
- **条件伤害加深**: 达到3层时，星辉破界而来·终结伤害加深25%
- **UI控制**: 震谐偏移层数滑块（0-3层）

#### 3. 星与星之间·聚爆（共鸣模态：聚爆）
- **暴击伤害提升**: 30% × 层数（最多2层）
- **条件伤害加深**: 达到2层时，星辉破界而来·终结伤害加深25%
- **UI控制**: 聚爆效应层数滑块（0-2层）

### 特殊机制

#### 共鸣模态：震谐
1. **震谐轨迹层数**（0-30层）
   - 影响释放共鸣技能时附带的震谐伤害
   - 计算公式：偏斜基础值 × (震谐轨迹层数 × 4% + 1) × 技能倍率 × 次数

2. **星屑共振·震谐状态**（开关）
   - 光翼共奏额外造成的震谐伤害次数从5次提升至10次

3. **震谐响应·星爆**
   - 当目标附加震谐干涉标记时，技能使用震谐伤害计算
   - 计算公式：偏斜基础值 × 技能倍率

#### 共鸣模态：聚爆
1. **聚爆轨迹层数**（1-30层）
   - 影响聚爆效应伤害的倍率
   - 倍率提升：聚爆轨迹层数 × 10% + 1

2. **聚爆效应层数**（0-10层或0-13层）
   - 基础上限：10层（倍率698.63%）
   - 带队友千咲时：13层（倍率1397.26%）

3. **星屑共振·聚爆状态**（开关）
   - 光翼共奏引爆的聚爆效应对主目标伤害倍率额外提升200%

## 三、千咲角色

### 基础信息
- **稀有度**: 5星
- **武器类型**: 佩枪
- **元素类型**: 导电伤害
- **成长模板**: 攻击

### 固有技能

#### 聚爆效应层数上限提升
- **效果**: 队伍中所有角色的聚爆效应层数上限+3
- **影响**: 爱弥斯的聚爆效应层数从10层提升至13层，伤害倍率翻倍

**注意**: 千咲的详细数值数据待后续填充

## 四、技术实现

### 文件结构

```
types/index.ts                        // 添加了新的伤害类型和配置接口
data/characters/aimisi.ts            // 爱弥斯角色完整数据
data/characters/qianxiao.ts          // 千咲角色骨架
data/index.ts                        // 注册新角色
lib/aimisiDamageHelper.ts           // 爱弥斯特殊伤害计算辅助函数
app/page.tsx                         // 更新伤害分布颜色配置
```

### 新增接口

#### DamageCalculationInput 扩展
```typescript
aimisiConfig?: {
  resonanceMode?: "震谐" | "聚爆";      // 共鸣模态
  zhenxieTrackStacks?: number;          // 震谐轨迹层数 (0-30)
  xingchenZhenxieEnabled?: boolean;     // 星屑共振·震谐
  hasZhenxieInterference?: boolean;     // 震谐干涉标记
  jubaoTrackStacks?: number;            // 聚爆轨迹层数 (1-30)
  jubaoEffectStacks?: number;           // 聚爆效应层数
  xingchenJubaoEnabled?: boolean;       // 星屑共振·聚爆
};
```

### 辅助函数

#### calculateZhenxieDamage
计算震谐伤害，支持震谐轨迹层数和星屑共振状态

#### calculateJubaoEffectDamage
计算聚爆效应伤害，支持聚爆轨迹层数、层数上限和星屑共振状态

#### calculateZhenxieResponseDamage
计算震谐响应·星爆伤害

#### hasQianxiaoEffectBoost / getJubaoUpperLimit
检测队友千咲并获取正确的聚爆效应层数上限

## 五、使用说明

### 基础使用

1. 在角色选择中选择"爱弥斯"
2. 配置角色等级、武器、声骸等基础属性
3. 在固有技能中启用相应的技能：
   - 如果使用震谐模态，启用"星与星之间·震谐"，设置震谐偏移层数
   - 如果使用聚爆模态，启用"星与星之间·聚爆"，设置聚爆效应层数

### 高级配置

要使用爱弥斯的特殊伤害机制，需要在代码中配置 `aimisiConfig`：

```typescript
const input: DamageCalculationInput = {
  // ... 其他配置
  aimisiConfig: {
    resonanceMode: "震谐",           // 或 "聚爆"
    zhenxieTrackStacks: 15,         // 震谐轨迹层数
    xingchenZhenxieEnabled: true,   // 启用星屑共振
    hasZhenxieInterference: false   // 目标是否有震谐干涉
  }
};
```

### 队友配置

添加千咲作为队友以提升聚爆效应层数上限：

```typescript
teammates: [
  {
    characterName: "千咲",
    character: QIANXIAO,
    enabledOutro: false,
    enabledPassives: [true]  // 启用聚爆效应层数提升
  }
]
```

## 六、未来扩展

### 待完成功能

1. **UI界面集成**
   - 添加爱弥斯专用配置面板
   - 共鸣模态切换控件
   - 震谐/聚爆轨迹层数滑块
   - 星屑共振状态开关

2. **伤害详情显示**
   - 在伤害计算结果中区分技能伤害、震谐伤害和效应伤害
   - 将"技能详情"改为"伤害详情"
   - 显示各类伤害的计算过程

3. **千咲角色完善**
   - 填充基础数值（HP、ATK、DEF）
   - 添加技能数据
   - 完善固有技能效果

4. **输出流程支持**
   - 在技能循环中自动计算附加的震谐/聚爆伤害
   - 伤害分布中单独统计震谐伤害和效应伤害

## 七、注意事项

1. **伤害类型区分**: 震谐伤害和效应伤害需要在伤害分布中与技能伤害区分开来显示
2. **条件判断**: 爱弥斯的某些技能只在特定共鸣模态下生效，需要在UI中明确标识
3. **特殊技能**: "震谐响应·星爆伤害"和"光翼共奏追加伤害（每次）"不应出现在技能选择列表中，它们是被固有技能调用的特殊技能
4. **层数上限**: 聚爆效应层数上限受队友千咲影响，需要动态计算

## 八、测试建议

1. 测试震谐模态下的伤害计算
2. 测试聚爆模态下的伤害计算
3. 测试千咲队友对聚爆效应层数上限的影响
4. 测试固有技能的条件伤害加深（层数达到上限时）
5. 测试伤害分布中新伤害类型的显示
